<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>کتابخانه لینک‌ها</title>
  <style>
    :root{--gap:8px;--book-width:100px;--book-height:150px}
    html,body{height:100%;margin:0;font-family:IRANSans, system-ui, sans-serif;background:#fdf6e3;color:#111}
    .wrap{max-width:100%;margin:0;padding:8px}

    .shelf{
      display:grid;
      grid-template-columns:repeat(3, 1fr);
      gap:var(--gap);
      justify-items:center;
      background:linear-gradient(to bottom,#f5f5dc 0%,#e0d7b0 100%);
      padding:8px;
    }

    .book{
      width:var(--book-width);
      height:var(--book-height);
      perspective:800px;
      cursor:pointer;
    }

    .book-inner{
      position:relative;
      width:100%;
      height:100%;
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }

    .book:hover .book-inner{
      transform: rotateY(15deg) translateY(-5px);
    }

    .book-front, .book-back{
      position:absolute;
      width:100%;
      height:100%;
      backface-visibility:hidden;
      border-radius:6px;
      overflow:hidden;
      box-shadow:0 2px 6px rgba(0,0,0,0.15);
    }

    .book-front{
      background-color:#fff;
    }

    .book-front img{
      width:100%;
      height:100%;
      object-fit:cover;
    }

    .book-back{
      background-color:#ffe4b5;
      transform:rotateY(180deg);
      display:flex;
      justify-content:center;
      align-items:center;
      font-size:12px;
      text-align:center;
      padding:4px;
    }

    @media (max-width:480px){.shelf{grid-template-columns:repeat(3,1fr)}} 
  </style>
</head>
<body>
  <div class="wrap">
    <div id="shelf" class="shelf"></div>
    <div id="info" style="display:none;text-align:center;padding:8px;"></div>
  </div>

  <script>
    const shelf = document.getElementById('shelf');
    const info = document.getElementById('info');

    async function loadData() {
      try {
        const r = await fetch('book.json');
        if (r.ok) return (await r.json()).map(normalize);
      } catch{}
      return [];
    }

    function normalize(x){
      if (typeof x !== 'object') return null;
      return { url: x.url||'', image: x.image||'' };
    }

    function render(items){
      shelf.innerHTML='';
      if(!items.length){ info.style.display='block'; info.textContent='موردی یافت نشد.'; return; }
      info.style.display='none';

      items.forEach(it=>{
        const book=document.createElement('div'); book.className='book';
        const inner=document.createElement('div'); inner.className='book-inner';

        const front=document.createElement('a'); front.className='book-front'; front.href=it.url; front.target='_blank';
        const img=document.createElement('img'); img.src=it.image||getPh(it.url);
        img.onerror=()=>img.src=getPh(it.url);
        front.appendChild(img);

        const back=document.createElement('div'); back.className='book-back'; back.textContent=it.url;

        inner.appendChild(front); inner.appendChild(back);
        book.appendChild(inner);
        shelf.appendChild(book);
      });
    }

    function getPh(text){
      const svg=`<svg xmlns='http://www.w3.org/2000/svg' width='100' height='150'><rect width='100%' height='100%' fill='%23f5f5dc'/></svg>`;
      return 'data:image/svg+xml;charset=UTF-8,'+encodeURIComponent(svg);
    }

    (async()=>{
      const all=(await loadData()).map(normalize).filter(Boolean);
      render(all);
    })();
  </script>
</body>
</html>
